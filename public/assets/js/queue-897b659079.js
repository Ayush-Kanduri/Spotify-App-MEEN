try{let e,a,t,i,r,s,l=document.querySelector(".footer"),o=document.querySelectorAll(".playable-tracks"),c=l.querySelector(".play-pause"),n=document.querySelector("audio"),u=l.querySelector(".song_volume"),d=l.querySelector(".clearQueue"),y=l.querySelector(".forward"),p=l.querySelector(".backward"),m=l.querySelector(".repeat"),g=l.querySelector(".shuffle");const f=async(e,a={})=>{try{const t=await fetch(e,a);return await t.json()}catch(e){console.log(e)}},v=async()=>{try{const o=(await f("/queue")).data;({Tracks:e,currentTrack:a,playbarVisible:t,volume:i,isPlaying:r,loop:s}=o),N(e[a]),n.src=e[a].url,n.volume=i,n.currentTime=e[a].currentTime,u.value=100*i,e[a].duration=n.duration,t&&r?(await b(e[a]),c.classList.remove("fa-circle-pause"),c.classList.add("fa-circle-play")):t&&!r&&(l.click(),await T(e[a]),c.classList.remove("fa-circle-play"),c.classList.add("fa-circle-pause")),l.click(),await T(e[a]),c.classList.remove("fa-circle-play"),c.classList.add("fa-circle-pause"),console.log("Tracks: ",e),console.log("currentTrack: ",a),console.log("playbarVisible: ",t),console.log("volume: ",i),console.log("isPlaying: ",r)}catch(e){}},w=async()=>{if(o&&o.length>0)for(let l of o)l.addEventListener("click",(async o=>{o.stopPropagation(),o.preventDefault();const u=l.getAttribute("data-song-name"),d=l.getAttribute("data-song-artist"),y=l.getAttribute("data-song-url"),p=l.getAttribute("data-song-thumbnail"),m=u.trim().toLowerCase(),g=e[a]?.name.trim().toLowerCase();if(m===g)return r?(await b(e[a]),c.classList.remove("fa-circle-pause"),void c.classList.add("fa-circle-play")):(await T(e[a]),c.classList.remove("fa-circle-play"),void c.classList.add("fa-circle-pause"));const v={name:u,artist:d,url:y,thumbnail:p,duration:0,currentTime:0,ended:!1,isPlaying:!0};if(e.filter((e=>e.name.trim().toLowerCase()===v.name.trim().toLowerCase())).length>0){if(a=e.findIndex((e=>e.name.trim().toLowerCase()===v.name.trim().toLowerCase())),-1===a)return;return n.src=e[a].url,n.volume=i,await T(e[a]),await N(e[a]),void(e[a].isPlaying&&(c.classList.remove("fa-circle-play"),c.classList.add("fa-circle-pause")))}const w=(await f("/queue/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Track:v,currentTrack:a,playbarVisible:t,volume:i,isPlaying:r,loop:s})})).data;({Tracks:e,currentTrack:a,playbarVisible:t,volume:i,isPlaying:r,loop:s}=w),n.src=e[a].url,n.volume=i,await T(e[a]),await N(e[a]),e[a].isPlaying&&(c.classList.remove("fa-circle-play"),c.classList.add("fa-circle-pause"))}));u.addEventListener("input",(async e=>{await _(e)})),u.addEventListener("wheel",(async e=>{await C(e)})),c.addEventListener("click",(async t=>{await E(e[a],t)})),y.addEventListener("click",(async e=>{await P()})),p.addEventListener("click",(async e=>{await q()})),d.addEventListener("click",(async e=>{await S()})),m.addEventListener("click",(async e=>{await h(e)})),g.addEventListener("click",(async e=>{await L()})),n.addEventListener("ended",(async t=>{await k(),a===e.length-1&&(s||(await b(e[a]),c.classList.remove("fa-circle-pause"),c.classList.add("fa-circle-play"))),await P()}))},L=async()=>{(e=>{let t,i=e.length;for(;0!==i;)t=Math.floor(Math.random()*i),i-=1,t!==a&&i!==a&&([e[i],e[t]]=[e[t],e[i]])})(e),new Noty({theme:"metroui",text:"Playlist Shuffled",type:"success",layout:"topRight",timeout:3e3}).show(),await f("/queue/shuffle",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Tracks:e,currentTrack:a})})},h=async e=>{s=!s,s&&e.target.classList.add("footer__green"),s||e.target.classList.remove("footer__green"),new Noty({theme:"metroui",text:"Loop is now "+(s?"ON":"OFF"),type:"success",layout:"topRight",timeout:3e3}).show();const a=await f("/queue/repeat",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({loop:s})});s=a.data.loop},T=async e=>{await n.play(),r=!0,t=!0,e.duration=n.duration,e.currentTime=n.currentTime,e.isPlaying=!n.paused,e.ended=n.ended,await f("/queue/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Track:e,currentTrack:a,playbarVisible:t,volume:i,isPlaying:r,loop:s})})},b=async e=>{await n.pause(),r=!1,t=!0,e.duration=n.duration,e.currentTime=n.currentTime,e.isPlaying=!n.paused,e.ended=n.ended,await f("/queue/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Track:e,currentTrack:a,playbarVisible:t,volume:i,isPlaying:r,loop:s})})},k=async()=>{n.src&&(await n.pause(),n.currentTime=0)},P=async()=>{(a!==e.length-1||s)&&(await k(),a===e.length-1&&s?a=0:a!==e.length-1&&s?a++:a===e.length-1||s||a++,n.src=e[a].url,n.volume=i,c.classList.remove("fa-circle-play"),c.classList.add("fa-circle-pause"),await N(e[a]),await T(e[a]))},q=async()=>{(0!==a||s)&&(await k(),0===a&&s?a=e.length-1:0!==a&&s?a--:0===a||s||a--,n.src=e[a].url,n.volume=i,c.classList.remove("fa-circle-play"),c.classList.add("fa-circle-pause"),await N(e[a]),await T(e[a]))},S=async()=>{await k(),e=[],a=-1,t=!1,i=.1,r=!1,s=!1,await f("/queue/clear",{method:"DELETE"}),await N()},C=async e=>{e.stopPropagation(),e.deltaY<0?(e.target.valueAsNumber+=1,n.volume=e.target.value/100):(e.target.value-=1,n.volume=e.target.value/100),i=n.volume,u.value=100*i,await f("/queue/volume",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({volume:i})}),e.preventDefault()},_=async e=>{n.volume=e.target.value/100,i=n.volume,u.value=100*i,await f("/queue/volume",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({volume:i})})},E=async(e,a)=>{e.isPlaying?(await b(e),a.target.classList.remove("fa-circle-pause"),a.target.classList.add("fa-circle-play")):(await T(e),a.target.classList.remove("fa-circle-play"),a.target.classList.add("fa-circle-pause"))},N=async(e=[])=>{if(t){l.style.display="flex";const a=l.querySelector(".footer__albumLogo"),t=l.querySelector(".footer__songInfo h4"),i=l.querySelector(".footer__songInfo p");a.src=e.thumbnail,t.textContent=e.name,i.textContent=e.artist,s&&m.classList.add("footer__green"),s||m.classList.remove("footer__green")}else l.style.display="none"};(()=>{window.addEventListener("beforeunload",(async function(l){l.preventDefault();const o=(await f("/queue")).data;({Tracks:e,currentTrack:a,playbarVisible:t,volume:i,isPlaying:r,loop:s}=o),r&&e[a].isPlaying&&(e[a].currentTime=n.currentTime,e[a].isPlaying=!0,e[a].duration=n.duration,await f("/queue/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Track:e[a],currentTrack:a,playbarVisible:t,volume:i,isPlaying:!0,loop:s})}))}))})(),v(),w()}catch(e){console.log(e)}
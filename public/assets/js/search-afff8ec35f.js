{let e,t,a,r,l,o,n=document.querySelector(".footer"),c=document.querySelectorAll(".playable-tracks"),s=n.querySelector(".play-pause"),i=document.querySelector("audio"),u=n.querySelector(".song_volume"),d=n.querySelector(".clearQueue"),y=n.querySelector(".forward"),m=n.querySelector(".backward"),p=n.querySelector(".repeat"),g=n.querySelector(".shuffle");const h=async(e,t={})=>{try{const a=await fetch(e,t);return await a.json()}catch(e){console.log(e)}},f=()=>{window.addEventListener("beforeunload",(async function(n){n.preventDefault();const c=(await h("/queue")).data;({Tracks:e,currentTrack:t,playbarVisible:a,volume:r,isPlaying:l,loop:o}=c),l&&e[t].isPlaying&&(e[t].currentTime=i.currentTime,e[t].isPlaying=!0,e[t].duration=i.duration,await h("/queue/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Track:e[t],currentTrack:t,playbarVisible:a,volume:r,isPlaying:!0,loop:o})}))}))},w=async()=>{try{const c=(await h("/queue")).data;({Tracks:e,currentTrack:t,playbarVisible:a,volume:r,isPlaying:l,loop:o}=c),$(e[t]),i.src=e[t].url,i.volume=r,i.currentTime=e[t].currentTime,u.value=100*r,e[t].duration=i.duration,a&&l?(await k(e[t]),s.classList.remove("fa-circle-pause"),s.classList.add("fa-circle-play")):a&&!l&&(n.click(),await T(e[t]),s.classList.remove("fa-circle-play"),s.classList.add("fa-circle-pause")),n.click(),await T(e[t]),s.classList.remove("fa-circle-play"),s.classList.add("fa-circle-pause"),console.log("Tracks: ",e),console.log("currentTrack: ",t),console.log("playbarVisible: ",a),console.log("volume: ",r),console.log("isPlaying: ",l)}catch(e){}},q=async()=>{u.addEventListener("input",(async e=>{await E(e)})),u.addEventListener("wheel",(async e=>{await A(e)})),s.addEventListener("click",(async a=>{await x(e[t],a)})),y.addEventListener("click",(async e=>{await P()})),m.addEventListener("click",(async e=>{await _()})),d.addEventListener("click",(async e=>{await N()})),p.addEventListener("click",(async e=>{await L(e)})),g.addEventListener("click",(async e=>{await v()})),i.addEventListener("ended",(async a=>{await C(),t===e.length-1&&(o||(await k(e[t]),s.classList.remove("fa-circle-pause"),s.classList.add("fa-circle-play"))),await P()}))},S=async()=>{try{if(c=document.querySelectorAll(".playable-tracks"),c&&c.length>0)for(let n of c)n.addEventListener("click",(async c=>{c.stopPropagation(),c.preventDefault();const u=n.getAttribute("data-song-name"),d=n.getAttribute("data-song-artist"),y=n.getAttribute("data-song-url"),m=n.getAttribute("data-song-thumbnail"),p=u.trim().toLowerCase(),g=e[t]?.name.trim().toLowerCase();if(p===g)return l?(await k(e[t]),s.classList.remove("fa-circle-pause"),void s.classList.add("fa-circle-play")):(await T(e[t]),s.classList.remove("fa-circle-play"),void s.classList.add("fa-circle-pause"));const f={name:u,artist:d,url:y,thumbnail:m,duration:0,currentTime:0,ended:!1,isPlaying:!0};if(e.filter((e=>e.name.trim().toLowerCase()===f.name.trim().toLowerCase())).length>0){if(t=e.findIndex((e=>e.name.trim().toLowerCase()===f.name.trim().toLowerCase())),-1===t)return;return i.src=e[t].url,i.volume=r,await T(e[t]),await $(e[t]),void(e[t].isPlaying&&(s.classList.remove("fa-circle-play"),s.classList.add("fa-circle-pause")))}const w=(await h("/queue/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Track:f,currentTrack:t,playbarVisible:a,volume:r,isPlaying:l,loop:o})})).data;({Tracks:e,currentTrack:t,playbarVisible:a,volume:r,isPlaying:l,loop:o}=w),i.src=e[t].url,i.volume=r,await T(e[t]),await $(e[t]),e[t].isPlaying&&(s.classList.remove("fa-circle-play"),s.classList.add("fa-circle-pause"))}))}catch(e){console.log(e)}},b=e=>{let a,r=e.length;for(;0!==r;)a=Math.floor(Math.random()*r),r-=1,a!==t&&r!==t&&([e[r],e[a]]=[e[a],e[r]]);return e},v=async()=>{b(e),new Noty({theme:"metroui",text:"Playlist Shuffled",type:"success",layout:"topRight",timeout:3e3}).show(),await h("/queue/shuffle",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Tracks:e,currentTrack:t})})},L=async e=>{o=!o,o&&e.target.classList.add("footer__green"),o||e.target.classList.remove("footer__green"),new Noty({theme:"metroui",text:"Loop is now "+(o?"ON":"OFF"),type:"success",layout:"topRight",timeout:3e3}).show();const t=await h("/queue/repeat",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({loop:o})});o=t.data.loop},T=async e=>{await i.play(),l=!0,a=!0,e.duration=i.duration,e.currentTime=i.currentTime,e.isPlaying=!i.paused,e.ended=i.ended,await h("/queue/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Track:e,currentTrack:t,playbarVisible:a,volume:r,isPlaying:l,loop:o})})},k=async e=>{await i.pause(),l=!1,a=!0,e.duration=i.duration,e.currentTime=i.currentTime,e.isPlaying=!i.paused,e.ended=i.ended,await h("/queue/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Track:e,currentTrack:t,playbarVisible:a,volume:r,isPlaying:l,loop:o})})},C=async()=>{i.src&&(await i.pause(),i.currentTime=0)},P=async()=>{(t!==e.length-1||o)&&(await C(),t===e.length-1&&o?t=0:t!==e.length-1&&o?t++:t===e.length-1||o||t++,i.src=e[t].url,i.volume=r,s.classList.remove("fa-circle-play"),s.classList.add("fa-circle-pause"),await $(e[t]),await T(e[t]))},_=async()=>{(0!==t||o)&&(await C(),0===t&&o?t=e.length-1:0!==t&&o?t--:0===t||o||t--,i.src=e[t].url,i.volume=r,s.classList.remove("fa-circle-play"),s.classList.add("fa-circle-pause"),await $(e[t]),await T(e[t]))},N=async()=>{await C(),e=[],t=-1,a=!1,r=.1,l=!1,o=!1,await h("/queue/clear",{method:"DELETE"}),await $()},A=async e=>{e.stopPropagation(),e.deltaY<0?(e.target.valueAsNumber+=1,i.volume=e.target.value/100):(e.target.value-=1,i.volume=e.target.value/100),r=i.volume,u.value=100*r,await h("/queue/volume",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({volume:r})}),e.preventDefault()},E=async e=>{i.volume=e.target.value/100,r=i.volume,u.value=100*r,await h("/queue/volume",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({volume:r})})},x=async(e,t)=>{e.isPlaying?(await k(e),t.target.classList.remove("fa-circle-pause"),t.target.classList.add("fa-circle-play")):(await T(e),t.target.classList.remove("fa-circle-play"),t.target.classList.add("fa-circle-pause"))},$=async(e=[])=>{if(a){n.style.display="flex";const t=n.querySelector(".footer__albumLogo"),a=n.querySelector(".footer__songInfo h4"),r=n.querySelector(".footer__songInfo p");t.src=e.thumbnail,a.textContent=e.name,r.textContent=e.artist,o&&p.classList.add("footer__green"),o||p.classList.remove("footer__green")}else n.style.display="none"};try{(()=>{const e=document.querySelector(".header");document.querySelector(".header__left").style.display="flex",e.style.justifyContent="space-between"})()}catch(e){console.log(e)}try{(async()=>{f(),w(),q()})()}catch(e){console.log(e)}try{const e=()=>{document.querySelector(".header__left input").addEventListener("input",(e=>{e.stopPropagation();const t=e.target.value;if(""===t)return s(document.querySelector(".songs")),s(document.querySelector(".albums")),s(document.querySelector(".playlists")),s(document.querySelector(".artists")),s(document.querySelector(".users")),i(document.querySelector(".songs")),i(document.querySelector(".albums")),i(document.querySelector(".playlists")),i(document.querySelector(".artists")),void i(document.querySelector(".users"));a(t)}))},t=async e=>{if(0!==e.length&&" "!==e)try{const t=await fetch(`/search/${e}`);return await t.json()}catch(e){return e}},a=((e,t)=>{let a;return(...r)=>{clearTimeout(a),a=setTimeout((()=>{e(...r)}),t)}})((async e=>{try{if(0===e.length)return;if(" "===e)return;let a=await t(e);if("error"===a.response)return console.log("Message: ",a.message),void console.log("Error: ",a.error);r(a.data.tracks),await S(),l(a.data.albums),o(a.data.playlists,a.data.existingPlaylists),n(a.data.artists),c(a.data.users)}catch(e){return}}),150),r=e=>{if(s(document.querySelector(".songs")),0!==e.length)for(let t of e){let e=document.querySelectorAll("template")[1].content.cloneNode(!0).children[0];e.setAttribute("data-song-url",t.url),e.setAttribute("data-song-artist",t.artist.name),e.setAttribute("data-song-name",t.name),e.setAttribute("data-song-thumbnail",t.thumbnail);let a=e.querySelector(".album"),r=e.querySelector("h4"),l=e.querySelector("p");t.thumbnail.includes("images")?a.style.backgroundImage=`url(..${t.thumbnail})`:a.style.backgroundImage=`url(../..${t.thumbnail})`,r.textContent=t.name,l.textContent=t.artist.name,document.querySelector(".songs").appendChild(e)}else i(document.querySelector(".songs"))},l=e=>{if(s(document.querySelector(".albums")),0!==e.length)for(let t of e){let e=document.querySelectorAll("template")[2].content.cloneNode(!0).children[0];e.onclick=()=>{window.location.href=`/albums/${t._id}`};let a=e.querySelector(".album"),r=e.querySelector("h4");t.thumbnail.includes("images")?a.style.backgroundImage=`url(..${t.thumbnail})`:a.style.backgroundImage=`url(../..${t.thumbnail})`,r.textContent=t.name,document.querySelector(".albums").appendChild(e)}else i(document.querySelector(".albums"))},o=(e,t)=>{if(s(document.querySelector(".playlists")),e.length+t.length!==0){for(let t of e){let e=document.querySelectorAll("template")[3].content.cloneNode(!0).children[0];e.onclick=()=>{window.location.href=`/playlists/custom/${t._id}`};let a=e.querySelector(".album img"),r=e.querySelector("h4");a.src=`${t.thumbnail}`,a.alt=t.name,r.textContent=t.name,document.querySelector(".playlists").appendChild(e)}for(let e of t){let t=document.querySelectorAll("template")[3].content.cloneNode(!0).children[0];t.onclick=()=>{window.location.href=`/playlists/${e._id}`};let a=t.querySelector(".album img"),r=t.querySelector("h4");a.src=`${e.thumbnail}`,a.alt=e.name,r.textContent=e.name,document.querySelector(".playlists").appendChild(t)}}else i(document.querySelector(".playlists"))},n=e=>{if(s(document.querySelector(".artists")),0!==e.length)for(let t of e){let e=document.querySelectorAll("template")[4].content.cloneNode(!0).children[0];e.onclick=()=>{window.location.href=`/artists/${t._id}`};let a=e.querySelector(".artistImage"),r=e.querySelector("h4");t.thumbnail.includes("images")?a.style.backgroundImage=`url(..${t.thumbnail})`:a.style.backgroundImage=`url(../..${t.thumbnail})`,r.textContent=t.name,document.querySelector(".artists").appendChild(e)}else i(document.querySelector(".artists"))},c=e=>{if(s(document.querySelector(".users")),0!==e.length)for(let t of e){let e=document.querySelectorAll("template")[5].content.cloneNode(!0).children[0];e.onclick=()=>{window.location.href=`/users/profile/${t._id}`};let a=e.querySelector(".artistImage img"),r=e.querySelector("h4");a.src=`${t.avatar}`,a.alt=t.name,r.textContent=t.name,document.querySelector(".users").appendChild(e)}else i(document.querySelector(".users"))},s=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},i=e=>{let t=document.querySelectorAll("template")[0].content.cloneNode(!0).children[0];e.appendChild(t)};e()}catch(e){console.log(e)}}